<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MARS V2 - AI Research</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-lg shadow-lg max-w-md w-full">
        <h1 class="text-2xl font-bold mb-6 text-center text-purple-600">MARS V2 深度研究系統</h1>

        <div class="mb-4">
            <label class="block text-gray-700 text-sm font-bold mb-2">研究主題</label>
            <input type="text" id="topic"
                class="shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"
                placeholder="例如：台積電未來展望...">
        </div>

        <button onclick="startResearch()"
            class="w-full bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline">
            開始研究
        </button>
    </div>

    <script>
        // Dynamically determine API URL based on current page location
        const API_HOST = window.location.hostname;
        const API_BASE = `http://${API_HOST}:8000/api/v2`;

        async function startResearch() {
            const topic = document.getElementById('topic').value;
            if (!topic) return alert("請輸入主題");

            try {
                const res = await fetch(`${API_BASE}/research`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ topic })
                });
                const data = await res.json();
                if (data.task_id) {
                    window.location.href = `/task.html?id=${data.task_id}`;
                } else {
                    alert("啟動失敗");
                }
            } catch (e) {
                alert("API 連線錯誤: " + e);
            }
        }
    </script>
</body>

</html>