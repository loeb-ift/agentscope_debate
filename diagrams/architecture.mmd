%% Mermaid Diagram: System Architecture (simplified)
flowchart LR
  subgraph Client
    UI[Web UI / CLI]
  end

  subgraph API
    A1[FastAPI Routes]
    A2[ToolRegistry]
    A3[DB Session]
  end

  subgraph Worker
    W1[run_debate_cycle]
    W2[DebateCycle]
    W3[Chairman]
    W4[Tool Invoker]
    W5[GuardrailAgent]
  end

  subgraph Redis
    R1[(Broker)]
    R2[(Backend)]
    R3[(Cache / PubSub)]
  end

  subgraph External
    S1[SearXNG]
    S2[DuckDuckGo]
    S3[Yahoo Finance]
    S4[TEJ]
    LLM[Ollama]
  end

  subgraph Database
    D1[(SQLite / RDB)]
    D2[(DebateArchive, Agent, ToolSet, AgentToolSet, PromptTemplate)]
  end

  UI -->|REST| API
  API -->|Task Enqueue| R1
  Worker -->|Consume| R1
  Worker -->|Store Results| R2
  API -->|Query Status| R2

  A2 <-->|invoke_tool| W4
  W4 -->|validate/cache/ratelimit| R3
  W4 -->|HTTP/SDK| External

  API -->|ORM| Database
  Worker -->|ORM| Database

  W1 --> W2 --> W3 --> LLM
  W2 --> W5 --> LLM
